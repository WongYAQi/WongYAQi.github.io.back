---
title: Javascript中的立即执行函数
date: 2019-09-03 22:29:18
tags: [javascript,每日一问]
---

Javascipt中的立即执行函数原理
<!--more  -->

## 立即执行函数
IIFE的主要对象是函数，函数表达式是可以直接调用的，但是函数声明不可以。
> 直接调用指的是 function(){}()

回想一下函数的使用
1. 定义一个函数`function a(){ code...} `
2. 用函数名a使用`a()`，这一步的实际的意义是`函数表达式()`的形式

而函数声明其实是可以表示为`var a = function(){}`
所以
```
function a(){
}()
是可以调用的吗？
不可以。unexpected token (
```

因为js引擎在解析的时候，会将function识别为一个匿名的函数声明。而函数声明是不能使用()的。
```
function a(){
    console.log(1)
}(1)
输出1，为什么可以呢？
```
这里是一个迷惑项，其实我们并不是执行了console.log操作。这里要解释为什么函数声明后不能使用()。
当一个函数声明后，会分为两段
```
function a(){
}()
=>
function a(){
};
();
```
而这里的()会抛出错误，他只是一个表示运算优先级的括号，里面如果有值的话，会直接显示值的内容。所以其实我们打印的是(1)里面的1，而不是console.log(1)的1.这里是一个js引擎的解析问题。

继续回到立即执行函数。所以为了能够实现函数表达式()的执行，我们需要将括号前面的内容，转变为一个表达式。

## 如何将括号前面的内容转变为表达式
首先说一下最常见的方式，这也是最推荐的方式。
```
(function(i){
}(i))
```
为什么这种方式可以呢？
也是涉及到了js解析的过程
1. 括号中不会有声明。(var i=0),(let i=0)都会报错。而(i=0)不会。
所以当()中包含了function关键字的时候，不会将他解析为函数声明，而是解析为函数表达式。

那么还有什么其他方式吗？有，而且很多。
```
(function(i){ } ) (i)
!function(i){ } (i)
+function(i){ } (i)
-function(i){ } (i)
~function(i){ } (i)
```
这些操作为什么可以呢？
一元操作符`+ - ~ ! `，当他们与函数声明处于同一个上下文的时候，JS引擎会将函数声明解析为表达式。更深入的讲，如果匿名函数声明和运算符在一起，那么就会解析为函数表达式，对吗？
对。
举几个例子


而(function(){}) 这里面的内部是一个函数表达式，原理同上，但是()会返回这个函数对象的引用，所以仍然可以使用加（）的方式执行。


## 有什么作用？
根据立即执行函数的特性来讲
1. 我们不需要定义新的变量，然后再去执行这个变量。只会去执行一次的函数。
2. 利用立即执行函数的作用域，我们可以解决闭包问题。简单的说，就是创建一个新的作用域。

由`创建新的作用域`能够解决的问题，都是他的作用。

私有属性，闭包

最后介绍一个定义对象的方式，模块模式。
```
var a = (function(){
    var i=0;
    return {
        get(){
            return i;
        }
        funca(){
            ++i;
        }
        funcb(){
            i--;
        }
    }
})();
这样我们得到了一个对象a，里面有一个私有属性i，是无法通过任何其他方法能够访问的。
```
我们将在后面介绍这种模式的详细信息。